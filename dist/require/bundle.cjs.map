{"version":3,"file":"bundle.cjs","sources":["../../src/sh.js","../../src/io.js","../../src/main.js"],"sourcesContent":["/*!\n * Shell Utils\n * @author amekusa\n */\n\nimport { env } from 'node:process';\nimport { exec } from 'node:child_process';\n\nconst sh = {\n\n\t/**\n\t * Executes the given shell command, and returns a Promise that resolves the stdout\n\t * @param {string} cmd\n\t * @param {object} [opts]\n\t * @return {Promise}\n\t */\n\texec(cmd, opts = {}) {\n\t\topts = Object.assign({\n\t\t\tdryRun: false,\n\t\t}, opts);\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (opts.dryRun) {\n\t\t\t\tconsole.log(`[DRYRUN] ${cmd}`);\n\t\t\t\treturn resolve();\n\t\t\t}\n\t\t\texec(cmd, (err, stdout) => {\n\t\t\t\treturn err ? reject(err) : resolve(stdout);\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Converts the given objects to shell arguments in a string form\n\t * @param {object} args\n\t * @param {object} [opts]\n\t * @return {string}\n\t */\n\targs(args, opts = {}) {\n\t\topts = Object.assign({\n\t\t\tsep: ' ', // key-value separator\n\t\t}, opts);\n\t\tlet r = [];\n\t\tfor (let key in args) {\n\t\t\tlet value = args[key];\n\t\t\tif (isNaN(key)) { // non-numeric key\n\t\t\t\tswitch (typeof value) {\n\t\t\t\tcase 'boolean':\n\t\t\t\t\tif (value) r.push(key);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'number':\n\t\t\t\t\tr.push(key + opts.sep + value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'string':\n\t\t\t\t\tr.push(key + opts.sep + `\"${value}\"`);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else { // numeric key\n\t\t\t\tr.push(value);\n\t\t\t}\n\t\t}\n\t\treturn r.join(' ');\n\t},\n\n\t/**\n\t * Returns if NODE_ENV is 'production'\n\t * @param {any} [set]\n\t * @return {bool}\n\t */\n\tprod(set = undefined) {\n\t\tlet value = 'production';\n\t\tif (set != undefined) env.NODE_ENV = set ? value : '';\n\t\treturn env.NODE_ENV == value;\n\t},\n\n\t/**\n\t * Returns if NODE_ENV is 'development'\n\t * @param {any} [set]\n\t * @return {bool}\n\t */\n\tdev(set = undefined) {\n\t\tlet value = 'development';\n\t\tif (set != undefined) env.NODE_ENV = set ? value : '';\n\t\treturn env.NODE_ENV == value;\n\t},\n\n};\n\nexport default sh;\n","/*!\n * I/O Utils\n * @author amekusa\n */\n\nimport fs from 'node:fs/promises';\nimport { join, basename, dirname } from 'node:path';\nimport { Transform } from 'node:stream';\n\nimport sh from './sh.js';\n\nconst io = {\n\n\t/**\n\t * Deletes the contents of the given directory\n\t * @return {Promise}\n\t */\n\tclean(dir, pattern, depth = 1) {\n\t\treturn sh.exec(`find '${dir}' -type f -name '${pattern}' -maxdepth ${depth} -delete`);\n\t},\n\n\t/**\n\t * Deletes the given file or directory\n\t * @param {string} file\n\t * @return {Promise}\n\t */\n\trm(file) {\n\t\treturn fs.rm(file, { force: true, recursive: true });\n\t},\n\n\t/**\n\t * Copies the given file(s) to another directory\n\t * @param {string|object|string[]|object[]} src\n\t * @param {string} dst Base destination directory\n\t * @return {Promise}\n\t */\n\tcopy(src, dst) {\n\t\tlet tasks = [];\n\t\t(Array.isArray(src) ? src : [src]).forEach(item => {\n\t\t\tlet _src, _dst;\n\t\t\tswitch (typeof item) {\n\t\t\tcase 'object':\n\t\t\t\t_src = item.src;\n\t\t\t\t_dst = item.dst;\n\t\t\t\tbreak;\n\t\t\tcase 'string':\n\t\t\t\t_src = item;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow 'invalid type';\n\t\t\t}\n\t\t\t_dst = join(dst, _dst || basename(_src));\n\t\t\ttasks.push(\n\t\t\t\tfs.mkdir(dirname(_dst), { recursive: true })\n\t\t\t\t.then(fs.copyFile(_src, _dst))\n\t\t\t);\n\t\t});\n\t\treturn Promise.all(tasks);\n\t},\n\n};\n\n/**\n * Stream Utils\n */\nio.stream = {\n\n\t/**\n\t * Returns a Transform stream object with the given function as its transform() method.\n\t * `fn` must return a string which is to be the new content, or a Promise which resolves a string.\n\t *\n\t * @example\n\t * return gulp.src(src)\n\t *   .pipe(modify((data, enc) => {\n\t *     // do stuff\n\t *     return newData;\n\t *   }));\n\t *\n\t * @param {function} fn\n\t * @return {Transform}\n\t */\n\tmodify(fn) {\n\t\treturn new Transform({\n\t\t\tobjectMode: true,\n\t\t\ttransform(file, enc, done) {\n\t\t\t\tlet r = fn(file.contents.toString(enc), enc);\n\t\t\t\tif (r instanceof Promise) {\n\t\t\t\t\tr.then(modified => {\n\t\t\t\t\t\tfile.contents = Buffer.from(modified, enc);\n\t\t\t\t\t\tthis.push(file);\n\t\t\t\t\t\tdone();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tfile.contents = Buffer.from(r, enc);\n\t\t\t\t\tthis.push(file);\n\t\t\t\t\tdone();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n};\n\nexport default io;\n","import sh from './sh.js';\nimport io from './io.js';\n\nconst main = {\n\tsh,\n\tio,\n};\n\nexport default main;\n"],"names":["exec","env","join","basename","dirname","Transform"],"mappings":"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"}